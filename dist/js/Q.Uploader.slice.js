//devin87@qq.com
//build:2018/07/24 15:47:37
!function(e,n){"use strict";var i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,t=Q.Uploader;t.extend({_upload_slice:function(e){var n,o=this,r=e.blob||e.file,a=r.size,l=o.chunkSize,s=e.sliceStart||0,c=o.sliceRetryCount,p=function(i,r,l){var d=new XMLHttpRequest,u=e.url,f=n==a;e.xhr=d,u+=(-1==u.indexOf("?")?"?":"&")+"action=upload&hash="+(e.hash||e.name)+"&ok="+(f?"1":"0"),d.upload.addEventListener("progress",function(n){o.progress(e,a,s+n.loaded)},!1);var m=function(){if(l=+l||0,++l>c)return o.complete(e,t.ERROR);p(i,r,l)};d.addEventListener("load",function(n){var i=n.target.responseText;return f?o.complete(e,t.COMPLETE,i):1==i||'"1"'==i?r():void m()},!1),d.addEventListener("error",m,!1);var v=new FormData;o._process_params(e,function(e,n){v.append(e,n)}),v.append("fileName",e.name),-1!=e.size&&v.append("fileSize",e.size),v.append(o.upName,i,e.name),v.append("sliceCount",e.sliceCount),v.append("sliceIndex",e.sliceIndex),d.open("POST",u),f?o.fire("send",e,function(n){if(!1===n)return o.complete(e,t.SKIP);d.send(v)}):d.send(v)};e.sliceCount=Math.ceil(a/l);var d=function(){s>=a||((n=s+l)>a&&(n=a),e.sliceStart=s,e.sliceEnd=n,e.sliceIndex=Math.ceil(n/l),e.sliceBlob=i.call(r,s,n),o.fire("sliceUpload",e,function(n){if(!1===n)return u();p(e.sliceBlob,u)}))},u=function(){s=n,d()};d(),o._afterSend(e)}})}(window);