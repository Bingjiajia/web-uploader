//devin87@qq.com
//build:2017/02/09 08:58:51
!function(e,t){"use strict";function r(e,r){return e!==t?e:r}function n(e){return"[object Function]"===k.call(e)}function i(e){return"number"==typeof e&&e>0&&e===Math.floor(e)}function a(e,t){return n(e)?e.apply(t,M.call(arguments,2)):void 0}function o(e,r,n){if(!e||!r)return e;for(var i in r)i!=t&&_.call(r,i)&&(n||e[i]===t)&&(e[i]=r[i]);return e}function s(e,t){if(t!==!1&&!/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))throw new Error("JSON SyntaxError");try{return new Function("return "+e)()}catch(r){}}function l(e,r){1>=r&&(r*=100),e.style.opacity!=t?e.style.opacity=r/100:e.style.filter!=t&&(e.style.filter="alpha(opacity="+parseInt(r)+")")}function u(e,t){var r=0,n=0,i=e.offsetWidth,a=e.offsetHeight;do r+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;while(e&&e!=t);return{left:r,top:n,width:i,height:a}}function c(e,t,r,n){for(var i=e[r||t],a=[];i;){if(1==i.nodeType){if(!n)return i;a.push(i)}i=i[t]}return n?a:null}function d(e){return e.previousElementSibling||c(e,"previousSibling",null,!1)}function f(e){return e.nextElementSibling||c(e,"nextSibling",null,!1)}function p(e){return e.firstElementChild||c(e,"nextSibling","firstChild",!1)}function h(e){return e.lastElementChild||c(e,"previousSibling","lastChild",!1)}function v(e){return e.children||c(e,"nextSibling","firstChild",!0)}function m(e,t,r){var n=document.createElement(e);return t&&(n.className=t),r&&(n.innerHTML=r),n}function g(e,t){var r=m("div","",e);return t?r.childNodes:p(r)}function w(t){var r=t||e.event;return r.target||(r.target=r.srcElement),r}function y(e,t,r,n){var i=function(a){r.call(e,w(a)),n&&N(e,t,i)};return O(e,t,i),n?void 0:{stop:function(){N(e,t,i)}}}function b(e,t){if(n(e[t]))e[t]();else if(e.fireEvent)e.fireEvent("on"+t);else if(e.dispatchEvent){var r=document.createEvent("HTMLEvents");r.initEvent(t,!0,!0),e.dispatchEvent(r)}}function x(e,t,r){var n=w(e);t!==!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1),r!==!1&&(n.stopPropagation?n.stopPropagation():n.cancelBubble=!0)}function E(e){return C.test(e)}function S(e){if(!E(e))return!0;var r=RegExp.lastMatch.length,n=e.indexOf("/",r),i=e.slice(0,-1!=n?n:t);return i.toLowerCase()==(location.protocol+"//"+location.host).toLowerCase()}function T(e,t,r){e=+e,t=t||1024;for(var n=0,a="number"==typeof t,o=1,s=i(r)?r:a?100:t.length;e>=o&&s>n;)o*=a?t:t[n],n++;return n&&o>e&&(o/=a?t:t.last(),n--),{value:n?e/o:e,level:n}}function L(e,n){if(n=n===!0?{all:!0}:n||{},isNaN(e)||e==t||0>e){var i=n.error||"--";return n.all?{text:i}:i}var a=T(e,n.steps,n.limit),o=a.value,s=o.toFixed(r(n.digit,2));return n.trim!==!1&&-1!=s.lastIndexOf(".")&&(s=s.replace(/\.?0+$/,"")),a.text=s+(n.join||"")+(n.units||H)[a.level+(n.start||0)],n.all?a:a.text}var k=Object.prototype.toString,_=Object.prototype.hasOwnProperty,M=Array.prototype.slice;o(Object,{forEach:function(e,t,r){for(var n in e)_.call(e,n)&&t.call(r,n,e[n],e)}}),o(Date,{now:function(){return+new Date}});var I;(e.ActiveXObject||e.msIndexedDB)&&(I=document.documentMode||(e.XMLHttpRequest?7:6)),e.JSON||(e.JSON={}),JSON.parse||(JSON.parse=s);var O,N;document.addEventListener?(O=function(e,t,r){e.addEventListener(t,r,!1)},N=function(e,t,r){e.removeEventListener(t,r,!1)}):document.attachEvent&&(O=function(e,t,r){e.attachEvent("on"+t,r)},N=function(e,t,r){e.detachEvent("on"+t,r)});var C=/^https?:\/\//i,H=["B","KB","MB","GB","TB","PB","EB"],Q={def:r,isFunc:n,isUInt:i,fire:a,extend:o,ie:I,setOpacity:l,getOffset:u,walk:c,getPrev:d,getNext:f,getFirst:p,getLast:h,getChilds:v,createEle:m,parseHTML:g,isHttpURL:E,isSameHost:S,parseLevel:T,formatSize:L};I&&(Q["ie"+(6>I?6:I)]=!0),Q.event={fix:w,stop:x,trigger:b,add:y},e.Q=Q}(window),function(e,t){"use strict";function r(e){var t=l.Lang;switch(e){case O:return t.ready;case N:return t.processing;case C:return t.complete;case H:return t.skip;case R:return t.cancel;case P:return t.error}return e}function n(){var t=e.XMLHttpRequest;t&&(new t).upload&&e.FormData&&(T=!0);var r=document.createElement("input");r.type="file",L=!!r.files,k=T}function i(e,t){var r=e.lastIndexOf(t);return-1!=r?e.slice(r):""}function a(e){if(e){for(var t=e.split(","),r={},n=0,i=t.length;i>n;n++)r[t[n]]=!0;return r}}function o(e,t){e.attachEvent?e.attachEvent("onload",t):e.addEventListener("load",t,!1)}function s(e,t,r){if(t&&!(0>=t)){var n,i=Date.now();if(r>=t)return n=i-e.startTime,n?e.avgSpeed=Math.min(Math.round(1e3*t/n),t):e.speed||(e.avgSpeed=e.speed=t),e.time=n||0,void(e.endTime=i);n=i-e.lastTime,200>n||(e.speed=Math.min(Math.round(1e3*(r-e.loaded)/n),e.total),e.lastTime=i)}}function l(e){var t=this;t.guid=e.guid||"uploader"+ ++_,t.url=e.url,t.dataType=e.dataType||"json",t.data=e.data,t.target=e.target,t.html5=T&&!!u(e.html5,!0),t.multiple=L&&t.html5&&!!u(e.multiple,!0),t.clickTrigger=k&&!!u(e.clickTrigger,!0),t.workerThread=t.html5?e.workerThread||1:1,t.workerIdle=t.workerThread,t.auto=e.auto!==!1,t.upName=e.upName||"upfile",t.allows=a(e.allows),t.disallows=a(e.disallows),t.chunkSize=e.chunkSize||2097152,t.isSlice=!!e.isSlice,t.isQueryState=!!u(e.isQueryState,t.isSlice),t.isMd5=!!u(e.isMd5,t.isSlice),t.isUploadAfterHash=e.isUploadAfterHash!==!1,t.container=e.container||document.body,e.getPos&&(t.getPos=e.getPos);var r=e.UI||{};r.init&&(t.init=r.init),r.draw&&(t.draw=r.draw),r.update&&(t.update=r.update),r.over&&(t.over=r.over),t.fns=e.on||{},t.ops=e,t.list=[],t.map={},t.index=0,t.started=!1,t._init()}var u=Q.def,c=Q.fire,d=Q.extend,f=Q.getFirst,p=Q.getLast,h=JSON.parse,v=Q.createEle,m=Q.parseHTML,g=Q.setOpacity,w=Q.getOffset,y=Q.md5File,b=Q.event,x=b.add,E=b.trigger,S=b.stop,T=!1,L=!1,k=!1,_=0,M=0,I=0,O=0,N=1,C=2,H=-1,R=-2,P=-3;l.prototype={constructor:l,_init:function(){var e=this;if(!e._inited){e._inited=!0;var r=e.guid,n=e.target,i=e.container,a=v("div","upload-input "+r);if(i.appendChild(a),e.boxInput=a,!e.html5){var s="upload_iframe_"+r,l='<iframe class="u-iframe" name="'+s+'"></iframe><form class="u-form" action="" method="post" enctype="multipart/form-data" target="'+s+'"></form>',u=v("div","upload-html4 "+r,l);i.appendChild(u);var c=f(u),d=p(u);e.iframe=c,e.form=d,o(c,function(){if(0==e.workerIdle){var r;try{r=c.contentWindow.document.body.innerHTML}catch(n){}e.complete(t,C,r)}})}return e.clickTrigger?x(n,"click",function(t){e.fire("select",t)!==!1&&(e.resetInput(),E(e.inputFile,"click"))}):(x(a,"click",function(t){e.fire("select",t)===!1&&S(t)}),g(a,0),e.resetInput()),e.fire("init"),e.run("init")}},resetInput:function(){var e=this,t=e.boxInput;t.innerHTML='<input type="file" name="'+e.upName+'" style="'+(e.clickTrigger?"visibility: hidden;":"font-size:100px;")+'"'+(e.multiple?' multiple="multiple"':"")+">";var r=f(t);return x(r,"change",function(t){e.add(this),e.html5||e.resetInput()}),e.inputFile=r,e.updatePos()},updatePos:function(e){var t=this;if(t.clickTrigger)return t;var r=t.getPos||w,n=t.boxInput,i=f(n),a=t.target,o=a.offsetWidth,s=a.offsetHeight,l=0==o?{left:-1e4,top:-1e4}:r(a);return n.style.width=i.style.width=o+"px",n.style.height=i.style.height=s+"px",n.style.left=l.left+"px",n.style.top=l.top+"px",e&&(n.style.zIndex=++I),t},fire:function(e,t,r){if(!r)return c(this.fns[e],this,t);var n=this.fns[e+"Async"];return n?c(n,this,t,r):void r(c(this.fns[e],this,t))},run:function(e,t){var r=this[e];return r&&c(r,this,t),this},addTask:function(e,t){if(e||t){var r,n;t?(r=t.name||t.fileName,n=t.size||t.fileSize):(r=i(e.value,"\\").slice(1)||e.value,n=-1);var a=this,o=i(r,".").toLowerCase(),s=a.disallows&&a.disallows[o]||a.allows&&!a.allows[o],l={id:++M,name:r,ext:o,size:n,input:e,file:t,state:s?H:O};return s&&(l.disabled=!0),a.fire("add",l,function(e){e===!1||l.disabled||(l.index=a.list.length,a.list.push(l),a.map[l.id]=l,a.run("draw",l),a.auto&&a.start())}),l}},add:function(e){var r=this;if("INPUT"==e.tagName){var n=e.files;if(n)for(var i=0,a=n.length;a>i;i++)r.addTask(e,n[i]);else r.addTask(e)}else r.addTask(t,e)},addList:function(e){for(var t=0,r=e.length;r>t;t++)this.add(e[t])},get:function(e){return e!=t?this.map[e]:void 0},cancel:function(e,t){var r=this,n=r.get(e);if(n){var i=n.state;if(i!=O&&i!=N)return r;if(i==N){var a=n.xhr;if(a)return a.abort(),r;r.iframe.contentWindow.location="about:blank"}return t?r:r.complete(n,R)}},remove:function(e){var t=this.get(e);t&&(t.state==N&&this.cancel(e),t.deleted=!0,this.fire("remove",t))},start:function(){var e=this,t=e.workerIdle,r=e.list,n=e.index,i=r.length;if(e.started||(e.started=!0),0>=i||n>=i||0>=t)return e;var a=r[n];return e.index++,e.upload(a)},upload:function(e){var t=this;return!e||e.state!=O||e.skip?t.start():(e.url=t.url,t.workerIdle--,t.fire("upload",e,function(r){return r===!1?t.complete(e,H):void(t.html5&&e.file?t._upload_html5_ready(e):e.input?t._upload_html4(e):t.complete(e,H))}),t)},queryState:function(e,t){var r=this,n=r.url,i=new XMLHttpRequest;return e.queryUrl=n+(-1==n.indexOf("?")?"?":"&")+"action=query&hash="+(e.hash||e.name),r.fire("sliceQuery",e),i.open("GET",e.queryUrl),i.onreadystatechange=function(){if(4==i.readyState){var n,a;if(i.status>=200&&i.status<400)if(n=i.responseText,"ok"===n?a={ret:1}:n&&(a=h(n)),a&&"number"!=typeof a||(a={ret:0,start:a}),e.response=n,e.json=a,1==a.ret)e.queryOK=!0,r.cancel(e.id,!0).complete(e,C);else{var o=+a.start||0;o!=Math.floor(o)&&(o=0),e.sliceStart=o}c(t,r,i)}},i.onerror=function(){c(t,r,i)},i.send(null),r},_upload_html5_ready:function(e){var t=this,r=function(){e.state!=C&&(t.isSlice?t._upload_slice(e):t._upload_html5(e))},n=function(r){t.fire("hash",e,function(){e.hash&&t.isQueryState&&e.state!=C?t.queryState(e,r):r()})},i=function(r){if(t.isMd5&&y){var i=t.fns.hashProgress;y(e.file,function(t,i){e.hash=t,e.timeHash=i,n(r)},function(r){c(i,t,e,r)})}else n(r)};return t.isUploadAfterHash?i(r):(r(),i()),t},_process_params:function(e,t){this.data&&Object.forEach(this.data,t),e.data&&Object.forEach(e.data,t)},_upload_html5:function(e){var t=this,r=new XMLHttpRequest;e.xhr=r,r.upload.addEventListener("progress",function(r){t.progress(e,r.total,r.loaded)},!1),r.addEventListener("load",function(r){t.complete(e,C,r.target.responseText)},!1),r.addEventListener("error",function(){t.complete(e,P)},!1),r.addEventListener("abort",function(){t.complete(e,R)},!1);var n=new FormData;t._process_params(e,function(e,t){n.append(e,t)}),n.append("fileName",e.name),n.append(t.upName,e.blob||e.file,e.name),r.open("POST",e.url),t.fire("send",e,function(i){return i===!1?t.complete(e,H):(r.send(n),void t._afterSend(e))})},_upload_html4:function(e){var t=this,r=t.form,n=e.input;return n._uploaded?t.complete(e,C):(n._uploaded=!0,n.name=t.upName,r.innerHTML="",r.appendChild(n),r.action=e.url,t._process_params(e,function(e,t){r.appendChild(m('<input type="hidden" name="'+e+'" value="'+t+'">'))}),void t.fire("send",e,function(n){return n===!1?t.complete(e,H):(r.submit(),void t._afterSend(e))}))},_afterSend:function(e){e.lastTime=e.startTime=Date.now(),e.state=N,this._lastTask=e,this.progress(e)},progress:function(e,t,r){t||(t=e.size),(!r||0>r)&&(r=0);var n=e.state||O;r>t&&(r=t),r>0&&n==O&&(e.state=n=N);var i=n==C;i&&(t=r=e.size),s(e,t,r),e.total=t,e.loaded=r,this.fire("progress",e),this.run("update",e)},_process_response:function(e,t){e.response=t,t&&"json"==this.dataType&&(e.json=h(t))},complete:function(e,r,n){var i=this;return e||1!=i.workerThread||(e=i._lastTask),e&&(r!=t&&(e.state=r),e.state!=N&&r!=C||(e.state=C,i.progress(e,e.size,e.size)),n!==t&&i._process_response(e,n)),r==R&&i.fire("cancel",e),i.fire("complete",e),i.run("over",e).run("update",e),i.workerIdle++,i.started&&i.start(),i}},l.extend=function(e,t){d(l.prototype,e,t)},n(),d(l,{support:{html5:T,multiple:L},READY:O,PROCESSING:N,COMPLETE:C,SKIP:H,CANCEL:R,ERROR:P,Lang:{ready:"准备中",processing:"上传中",complete:"已完成",skip:"已跳过",cancel:"已取消",error:"已失败"},getStatusText:r}),Q.Uploader=l}(window),function(e,t){"use strict";function r(e,t){e.className+=" "+t}function n(e,t){e&&(e.innerHTML=t||"")}function i(t,r){var n=e.URL||e.webkitURL;if(n)return r(n.createObjectURL(t));if(e.FileReader){var i=new FileReader;i.onload=function(e){r(e.target.result)},i.readAsDataURL(t)}else t.readAsDataURL&&r(t.readAsDataURL())}function a(e,r,n){var a=r.input,o=r.file||(a.files?a.files[0]:t);if(o)i(o,function(t){t&&(e.innerHTML='<img src="'+t+'" />'),n&&n(t)});else if(a){var s=a.value;if(s&&!/^\w:\\fakepath/.test(s)||(a.select(),parent.document.body.focus(),document.selection&&(s=document.selection.createRange().text)),s){e.innerHTML='<img src="'+s+'" />';try{p>6&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+s+"')")}catch(l){}}n&&n(s)}}function o(e){var t=e.slice(1);return"image/"+("jpg"==t?"jpeg":t)}function s(e,t){for(var r=e.split(","),n=atob(r[1]),i=[],a=0,o=n.length;o>a;a++)i[a]=n.charCodeAt(a);if(v)return new v([new Uint8Array(i)],{type:t});var s=new m;return s.append(i),s.getBlob(t)}function l(e,t,r,n){var i=new Image;i.src=e,i.onload=function(){var e=i.width,a=i.height,o=r.maxWidth,s=r.maxHeight,l=o&&e>o,u=s&&a>s,c=l||u;if(!c)return n&&n(!1);l&&(e=o,a=Math.floor(i.height*e/i.width)),u&&(a=s,e=Math.floor(i.width*a/i.height));var d=document.createElement("canvas"),f=d.getContext("2d");d.width=e,d.height=a,f.drawImage(i,0,0,e,a),n&&n(d.toDataURL(t),t)}}var u=Q.getFirst,c=Q.getNext,d=Q.createEle,f=Q.setOpacity,p=Q.ie,h=Q.Uploader,v=e.Blob||e.WebkitBlob||e.MozBlob,m=e.WebKitBlobBuilder||e.MozBlobBuilder,g=function(){if(!e.FileReader||!e.atob||!v&&!m)return!1;var t=document.createElement("canvas");return!!t.getContext&&!!t.getContext("2d")}(),w=".jpg,.png,.gif,.bmp,.webp,.tif,.tiff",y=".jpg";h.support.imageScale=g,h.previewImage=a,h.scaleImage=l,h.extend({init:function(){var e=this.ops,t=e.boxView;e.allows||(e.allows=w),t&&r(t,this.html5?"html5":"html4")},supportScale:function(e){if(!g)return!1;".jpeg"==e&&(e=".jpg");var t=(this.ops.scale||{}).types||y,r=-1!=w.indexOf(e);return r?"*"==t||-1!=t.indexOf(e):!1},previewImage:function(e,t,r){var n=this,i=t.scale||r.scale,u=i&&n.supportScale(t.ext);return u&&(t.skip=!0),a(e,t,function(e){n.fire("preview",{task:t,src:e}),e&&u&&l(e,o(t.ext),i,function(e,r){if(e){var i=s(e,r);t.blob=i,t.skip=!1,n.list.push(t),n.fire("scale",{task:t,base64:e,type:r,blob:i}),n.auto&&n.start()}})}),n},draw:function(e){var t=this,r=t.ops,n=r.view;if(n){var i=e.name,a='<div class="u-img"></div><div class="u-progress-bar"><div class="u-progress"></div></div><div class="u-detail"></div><div class="u-name" title="'+i+'">'+i+"</div>",o=e.id,s=d("div","u-item",a);s.taskId=o;var l=u(s),p=c(l),h=u(p),v=c(p);f(p,.3),f(h,.5),e.box=s,e.boxProgress=h,e.boxDetail=v,n.appendChild(s),t.previewImage(l,e,r).update(e)}},update:function(e){if(e&&e.box){var r=this,i=e.total||e.size,a=e.loaded,o=e.state,s=e.boxProgress,l=e.boxDetail,u=h.getStatusText(o);if(r.html5&&a!=t&&a>=0){var c;if(o==h.PROCESSING){var d=Math.min(100*a/i,100);c=d.toFixed(1),"100.0"==c&&(c="99.9")}else o==h.COMPLETE&&(c="100");c&&(c+="%",u+=" "+c,s.style.width=c)}n(l,u)}},over:function(e){e&&e.box&&r(e.box,"u-over")}})}(window);